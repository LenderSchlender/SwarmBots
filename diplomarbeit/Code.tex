% Macros to include code from files
% technically this should go into the preamble, but it fits in better here
% THIS REQUIRES SHELL ESCAPE TO BE ENABLED!!
% enable using the latexmk argument --shell-escape

% Documentation for expl3 Syntax:
% https://texdoc.org/serve/interface3/0
\ExplSyntaxOn

\NewDocumentCommand{\LstInputDir}{O{} m} {
  % check if shell escape is enabled
  \sys_if_shell:F {
  % TODO error message
  }
  % Create temp file
  % check if we're using a unix-ish system or windows
  \sys_if_platform_unix:TF
  % Unix version
  {
    \typeout{\c_sys_jobname_str}
    % list all files an write the list into a file JobName.tmp
    \sys_shell_now:e {find~..~-type~f~-path~"#2"~>~\c_sys_jobname_str.tmp}
  }
  % Windows version
  {
    %TODO windows version
  }

  % open temp file Jobname.temp
  \ior_open:Nn \g_tmpa_ior {\c_sys_jobname_str.tmp}
  % if the file is empty, don't execute the next block 
  \quark_if_no_value:NF \g_tmpa_ior
  {
    % for each line
    \ior_map_inline:Nn \g_tmpa_ior
    {
      % include listing (and forward any options
      % TODO print file name somewhere
      \lstinputlisting[#1]{##1}
    }
  }
  % close file
  \ior_close:N \g_tmpa_ior

  % Delete temp file
  \sys_if_platform_unix:TF
  % Unix version
  {
    \sys_shell_now:e {rm~-f~\c_sys_jobname_str.tmp}
  }
  % Windows version
  {
    %TODO windows version
  }
}

\ExplSyntaxOff

\chapter{Code}
Es folgt die aktuelle Version der Sourcecodes vom \today.

\LstInputDir{../proto/*.proto}